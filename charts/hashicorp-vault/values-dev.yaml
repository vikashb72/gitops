env:
  EVT: dev
  EXTERNAL_VAULT_ADDR: https://192.168.0.22:8200
  VAULT_EXTERNAL_IP: 192.168.49.2

vault:
  global:
    enabled: true
    tlsDisable: false
  csi:
    enabled: false
  injector:
    enabled: true
  ui:
    enabled: true
    serviceType: NodePort
    serviceNodePort: 30001
    externalIPs:
      - 192.168.49.2
  server:
    dataStorage:
      storageClass: nfs-client
    extraEnvironmentVars:
      VAULT_CACERT: /vault/userconfig/vault-ha-tls/vault.ca
      VAULT_TLSCERT: /vault/userconfig/vault-ha-tls/vault.crt
      VAULT_TLSKEY: /vault/userconfig/vault-ha-tls/vault.key
      VAULT_TOKEN: /vault/userconfig/vault-ha-tls/vault_token
    volumes:
      - name: userconfig-vault-ha-tls
        secret:
         defaultMode: 420
         secretName: vault-ha-tls
    volumeMounts:
      - mountPath: /vault/userconfig/vault-ha-tls
        name: userconfig-vault-ha-tls
        readOnly: true
    standalone:
      enabled: false
    affinity: ""
    ha:
      enabled: true
      replicas: 3
      raft:
        enabled: true
        setNodeId: true
        config: |
          cluster_name = "vault-integrated-storage"
          ui = true
          listener "tcp" {
             tls_disable = 0
             address = "[::]:8200"
             cluster_address = "[::]:8201"
             tls_cert_file = "/vault/userconfig/vault-ha-tls/vault.crt"
             tls_key_file  = "/vault/userconfig/vault-ha-tls/vault.key"
             tls_client_ca_file = "/vault/userconfig/vault-ha-tls/vault.ca"
          }
          storage "raft" {
             path = "/vault/data"
          }
          #https://developer.hashicorp.com/vault/docs/configuration/seal/transit
          seal "transit" {
             address = "https://192.168.0.22:8200"   # env:VAULT_ADDR
             #token= "<token>"                       # env:VAULT_TOKEN
             disable_renewal = "false"       
             key_name = "autounseal-dev" # env:VAULT_TRANSIT_SEAL_KEY_NAME
             mount_path = "transit/"
             tls_ca_cert = "/vault/userconfig/vault-ha-tls/vault.ca"
          }
          #https://developer.hashicorp.com/vault/docs/configuration/seal/azurekeyvault
          #seal "azurekeyvault" {
          #  tenant_id      = ""       # env:AZURE_TENANT_ID
          #  client_id      = ""       # env:AZURE_CLIENT_ID
          #  client_secret  = ""       # env:AZURE_CLIENT_SECRET
          #  vault_name     = ""       # env:VAULT_AZUREKEYVAULT_VAULT_NAME
          #  key_name       = ""       # env:VAULT_AZUREKEYVAULT_KEY_NAME
          #}

          disable_mlock = true
          service_registration "kubernetes" {}
