apiVersion: "apps/v1"
kind: Deployment
metadata:
  name: vault-raft-snapshot-agent
  namespace: vault
spec:
  template:
    spec:
      containers:
        #- name: vault-raft-snapshot-agent
        #  env:
        #    - name: AZURE_STORAGE_ACCOUNT
        #      valueFrom:
        #        secretKeyRef:
        #          name: raft-snapshot-az-storage
        #          key: AZURE_STORAGE_ACCOUNT
        #    - name: AZURE_STORAGE_KEY
        #      valueFrom:
        #        secretKeyRef:
        #          name: raft-snapshot-az-storage
        #          key: AZURE_STORAGE_KEY
          volumeMounts:
            - mountPath: /etc/vault.d/
              name: config
              readOnly: true
            - mountPath: /vault/snapshots
              name: snapshots-pv
      volumes:
        - name: config
          configMap:
            name: vault-raft-snapshot-agent
        - name: snapshots-pv
          persistentVolumeClaim:
            claimName: vault-raft-snapshot-agent-storage
